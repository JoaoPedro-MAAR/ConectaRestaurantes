<div class="list-container">
  
  <div class="header-actions">
    <h2>{{ title }}</h2>
    <a routerLink="/menu/new" class="btn-primary">
      + Novo Cardápio
    </a>
  </div>

  <div class="active-menu header-actions">
    <h3>Cardápio Ativo</h3>
    <div class="botoes">
        <button class="btn-icon filter" (click)="toggleFilterModal()" title="Filtrar Cardápios">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                <path fill="currentColor" d="M11 20q-.425 0-.712-.288T10 19v-6L4.2 5.6q-.375-.5-.112-1.05T5 4h14q.65 0 .913.55T19.8 5.6L14 13v6q0 .425-.288.713T13 20z"/>
            </svg>
        </button>
    </div>
  </div>
  <app-menu-filter-modal
    [isOpen]="isFilterOpen()" 
    (closeModal)="closeFilterModal()"
    (filterApplied)="handleFilterApplied($event)" />

  <div class="content-wrapper" *ngIf="menus$ | async as menus">

    <table class="styled-table" *ngIf="menus.length > 0; else emptyState">
      <thead>
        <tr>
          <th>ID</th>
          <th>Nome</th>
          <th>Descrição</th>
          <th>Padrão</th> <th class="col-actions">Ações</th>
        </tr>
      </thead>
      <tbody>
        <tr class="active-menu" *ngIf="activeMenu">
            <td> # {{ activeMenu.id}}</td>
            <td> 
                <strong> 
                    {{ activeMenu.nome.length > 50 ? (activeMenu.nome | slice:0:50) + '...' : activeMenu.nome }}
                </strong>
                <span class="badge-ativo">ATIVO</span> 
            </td>
            <td>
                <span title="{{ activeMenu.descricao }}">
                    {{ activeMenu.descricao.length > 50 ? (activeMenu.descricao | slice:0:50) + '...' : activeMenu.descricao }}
                </span>
            </td> 
            <td>
                <span *ngIf="activeMenu.turnoPadrao" class="badge-turno">{{ formatTurno(activeMenu.turnoPadrao) }}</span>
                <span *ngIf="!activeMenu.turnoPadrao" class="text-muted">-</span>
            </td>
            <td class="col-actions">
                <button (click)="onUnpublish()" class="btn-icon publish" title="Desativar Cardápio">
                    <span class="material-symbols-outlined" style="color: green;">unpublished</span>          
                </button>
                
                <button (click)="openStandardModal(activeMenu)" class="btn-icon star" title="Definir como Padrão">
                    <span class="material-symbols-outlined">star</span>
                </button>

                <button [routerLink]="['/menu', activeMenu.id]" class="btn-icon edit" title="Editar">
                    <span class="material-symbols-outlined">edit</span>
                </button>
                <button (click)="deleteMenu(activeMenu.id)" class="btn-icon delete" title="Excluir">
                    <span class="material-symbols-outlined">delete</span>
                </button>
            </td>
        </tr>

        <ng-container *ngFor="let menu of menus">
            <tr *ngIf="menu.id !== activeMenu?.id">
                <td># {{ menu.id }}</td>
                <td>
                    <strong> 
                        {{ menu.nome.length > 50 ? (menu.nome | slice:0:50) + '...' : menu.nome }}
                    </strong>
                </td>
                <td>
                    <span title="{{ menu.descricao }}">
                        {{ menu.descricao.length > 50 ? (menu.descricao | slice:0:50) + '...' : menu.descricao }}
                    </span>
                </td>
                <td>
                    <span *ngIf="menu.turnoPadrao" class="badge-turno">{{ formatTurno(menu.turnoPadrao) }}</span>
                    <span *ngIf="!menu.turnoPadrao" class="text-muted">-</span>
                </td>
                <td class="col-actions">
                    <button (click)="onPublish(menu)" class="btn-icon publish" title="Tornar Ativo">
                        <span class="material-symbols-outlined">publish</span>          
                    </button>

                    <button (click)="openStandardModal(menu)" class="btn-icon star" title="Definir como Padrão">
                        <span class="material-symbols-outlined">star</span>
                    </button>

                    <button [routerLink]="['/menu', menu.id]" class="btn-icon edit" title="Editar">
                        <span class="material-symbols-outlined">edit</span>
                    </button>
                    <button (click)="deleteMenu(menu.id)" class="btn-icon delete" title="Excluir">
                        <span class="material-symbols-outlined">delete</span>
                    </button>
                </td>
            </tr>
        </ng-container>
      </tbody>
    </table>

    <ng-template #emptyState>
      <div class="empty-box">
        <p>Nenhum cardápio encontrado.</p>
        <small>Clique em "Novo Cardápio" para começar.</small>
      </div>
    </ng-template>

  </div>

  <div class="pagination-controls" *ngIf="total_itens > 0">
    <button (click)="prevPage()" [disabled]="current_page === 0" class="btn-page">Anterior</button>
    <span class="page-info">
      Página <strong>{{ current_page + 1 }}</strong> de <strong>{{ total_pages }}</strong> 
      <span class="total-badge">(Total: {{ total_itens }})</span>
    </span>
    <button (click)="nextPage()" [disabled]="current_page >= total_pages - 1" class="btn-page">Próxima</button>
  </div>

</div>

<div class="modal-backdrop" *ngIf="showStandardModal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>Definir Padrão</h3>
            <span class="close-btn" (click)="closeStandardModal()">&times;</span>
        </div>
        <div class="modal-body">
            <p>Escolha o turno para tornar o cardápio <strong>"{{ selectedMenuForStandard?.nome }}"</strong> padrão:</p>
            
            <div class="turno-options">
                <button class="btn-turno" (click)="confirmSetStandard('CAFE_DA_MANHA')">
                    <span class="material-symbols-outlined">bakery_dining</span> Café da Manhã
                </button>
                <button class="btn-turno" (click)="confirmSetStandard('ALMOCO')">
                    <span class="material-symbols-outlined">restaurant</span> Almoço
                </button>
                <button class="btn-turno" (click)="confirmSetStandard('JANTAR')">
                    <span class="material-symbols-outlined">dinner_dining</span> Jantar
                </button>
            </div>

            <div *ngIf="selectedMenuForStandard?.turnoPadrao" class="remove-area">
                <hr>
                <button class="btn-danger-outline" (click)="confirmRemoveStandard()">
                    Remover dos Padrões
                </button>
            </div>
        </div>
    </div>
</div>